- let quantTotal = qntPrImp = 0;
.row.mt-3
	.col-sm-6
		.quantTotal
			span 总条目: 
			span #{qutpds.length}
	.col-sm-6.text-right
		.quantTotal
			span 总数量: 
			span#span-quantTotal
table.mt-3.table.table-bordered
	thead.thead-light
		th 品牌
		th 系列
		th 产品规格
		th 工艺面料
		th(style="width:10%") 备注
		th(style="width:18%") 数量 | 价格(欧元)
	thead
		each qutpd in qutpds
			- let brandnum = '';
			each brand in brands
				if brand.brandNome == qutpd.brandNome
					- brandnum = brand.num;
			tr.text-info.pdTr(pdbrand=brandnum, pdSts=qutpd.qntpdSts, id="tr-compdid-"+qutpd._id)
				td
					span.border.p-1
						span.text-dark N. 
						- let qntnum = '-'
						if qutpd.qntnum
							- qntnum = qutpd.qntnum;
						span(id="span-qntnum-"+qutpd._id) #{qntnum}
					.brandnome.mt-3
						if qutpd.brand
							- brand = qutpd.brand;
							span [#{brand.nome}]
						else
							span #{qutpd.brandNome}

					if qutpd.area
						-a;
						.pdarea.mt-3
							span.text-dark 区域: 
							span #{qutpd.area}
				td
					.pdnome
						span.text-dark 品类: 
						span #{qutpd.pdNome}
					if qutpd.pdfir
						- pdfir = qutpd.pdfir;
						.pdfircode.mt-3
							span.text-dark 系列名: 
							span [#{pdfir.code}]
					else
						- let firNome = '产品系列名称';
						if qutpd.firNome
							- firNome = qutpd.firNome;
						.firnome.mt-3
							span.text-dark 系列名: 
							span #{firNome}
					.photo.mt-3
						- let photo = "/imgs/createPicture.jpg";
						if qutpd.photo
							- photo = qutpd.photo;
							img.thumbnailImg(src=photo, width="120px")
						else if qutpd.firphoto
							- photo = qutpd.firphoto;
							img.thumbnailImg(src=photo, width="120px")
						else
							img(src=photo, width="120px")
				td
					if qutpd.pdsec
						- pdsec = qutpd.pdsec;
						.pdseccode
							span.text-dark 产品编码: 
							span [#{pdsec.code}]
						.pdsecspec.mt-3
							span.text-dark 产品尺寸: 
							span [#{pdsec.spec}]
					else
						.pdseccode
							span.text-dark 产品编码: 
							span #{qutpd.secNome}
						.pdsecspec.mt-3
							span.text-dark 产品尺寸: 
							span #{qutpd.specf}

					.sketch.mt-3
						- let sketch = "/imgs/createPicture.jpg";
						if qutpd.sketch
							- sketch = qutpd.sketch;
							img.thumbnailImg(src=sketch, width="120px")
						else if qutpd.pdsec
							-a;
							- sketch = qutpd.pdsec.photo;
							img.thumbnailImg(src=sketch, width="120px")
						else
							img(src=sketch, width="120px")
				td
					- let pdthdcode = '查找数据库';
					if qutpd.pdthd
						- pdthdcode = '['+qutpd.pdthd.code+']';
						.pdthdPrice.text-dark [原价: #{qutpd.pdthd.price} €]
					.pdthdcode #{pdthdcode}
					.pdmater.mt-3 #{qutpd.mater}
					.pdcraft.mt-3 #{qutpd.craft}
					.images.row
						- let subsp = -1;
						each image in qutpd.images
							- subsp++;
							if image && image.length > 5
								-a;
								.col-6
									img.thumbnailImg.mt-2(src=image, width="120px")
				td
					span #{qutpd.note}

				td
					if qutpd.qntpdSts != Conf.status.del.num
						- quantTotal += qutpd.quant;
						.quant
							span.text-dark 数量: 
							span #{qutpd.quant}
							input(id="quant-qntPr-"+qutpd._id, type="hidden", value=qutpd.quant)

						.estimate.text-dark.mt-2
							span 预估单价:
							if qutpd.estimate
								- a;
								span #{qutpd.estimate}
							else
								span 未预估

						if qut.status >= Conf.status.pricing.num
							-a;
							.strmup.mt-3
								span.text-dark 供应商: 
								if qutpd.strmup
									- strmup = qutpd.strmup;
									span.text-warning.clickup(id="span-strmup-"+qutpd._id) #{strmup.nome}
								else
									span.text-warning.clickup(id="span-strmup-"+qutpd._id) 选供应商
								form(id="form-strmup-"+qutpd._id, action="/mgQutpdUpdAjax", style="display:none")
									input(type="hidden", name="obj[_id]", value=qutpd._id)
									.form-group.row
										.col-12
											select.selectup.form-control(id="sel-strmup-"+qutpd._id, name="obj[strmup]", data-style="btn-info")
												option(value='null') 选供应商
												each strmup in strmups
													-a;
													if !qutpd.strmup
														-a;
														option(value=strmup._id) #{strmup.nome}
													else if String(strmup._id) == String(qutpd.strmup._id)
														-a;
														option(value=strmup._id, selected="selected") #{strmup.nome}
													else
														option(value=strmup._id) #{strmup.nome}
							.dutPr.mt-2
								span.text-dark 采购单价:
								if qutpd.dutPr && !isNaN(qutpd.dutPr)
									- a;
									span.text-warning.clickup(id="span-dutPr-"+qutpd._id) #{(qutpd.dutPr).toFixed(2)}
									span &nbsp;€
								else
									span.text-warning.clickup(id="span-dutPr-"+qutpd._id) 未报价
									span &nbsp;€
								if qut.status == Conf.status.pricing.num
									-a;
									input(id="org-dutPr-"+qutpd._id, type="hidden", value=qutpd.dutPr)
									form.ajaxForm(id="form-dutPr-"+qutpd._id, action="/mgQutpdUpdAjax", style="display:none")
										input(type="hidden", name="obj[_id]", value=qutpd._id)
										.form-group.row
											.col-12
												input.blurup.form-control(id="ipt-dutPr-"+qutpd._id, type="text", name="obj[dutPr]", placeholder="填写采购价格", autocomplete="off", value=qutpd.dutPr)
							.qntPr.mt-3
								span.text-dark 报价单价:
								if qutpd.qntPr && !isNaN(qutpd.qntPr)
									- a;
									span.text-warning.clickup(id="span-qntPr-"+qutpd._id) #{(qutpd.qntPr).toFixed(2)}
									span &nbsp;€
								else
									span.text-warning.clickup(id="span-qntPr-"+qutpd._id) 未报价
									span &nbsp;€
								if qut.status == Conf.status.pricing.num
									-a;
									input(id="org-qntPr-"+qutpd._id, type="hidden", value=qutpd.qntPr)
									form.ajaxForm(id="form-qntPr-"+qutpd._id, action="/mgQutpdUpdAjax", style="display:none")
										input(type="hidden", name="obj[_id]", value=qutpd._id)
										.form-group.row
											.col-12
												input.blurup.form-control(id="ipt-qntPr-"+qutpd._id, type="text", name="obj[qntPr]", placeholder="填写报价", autocomplete="off", value=qutpd.qntPr)
							h5.text-dark.total
								span 总价:
								if qutpd.qntPr && !isNaN(qutpd.qntPr)
									- a;
									if !isNaN(qntPrImp)
										- qntPrImp += qutpd.quant * qutpd.qntPr;
									span(id="tot-qntPr-"+qutpd._id) #{(qutpd.qntPr * qutpd.quant).toFixed(2)}
									span &nbsp;€
								else
									- qntPrImp = '未完成报价';
									span(id="tot-qntPr-"+qutpd._id)  未报价
									span &nbsp;€

					else
						.del.text-danger
							div.text-center 删除原因:
							.delNote.mt-2 #{qutpd.delNote}
					.qutpdSts.mt-3
						input.statusInput(type="hidden", value=qutpd.qntpdSts)
						- let status = '';
						each sts in Conf.status
							- status = '';
							if sts.num == qutpd.qntpdSts
								- status = sts.val;
								- break;
						span.text-dark 商品状态: 
						if qut.status > Conf.status.init.num
							-a;
							span.text-danger #{status}
						else
							span.text-danger 创建中
.row
	.col-12.text-right
		input#ipt-quantTotal(type="hidden", value=quantTotal)
		input#ipt-qntPrImp(type="hidden", value=qntPrImp)
script(src="/js/user/mger/qut/compdEdit.js")